<section class="cal">
  <header class="cal-head">
    <button class="nav" (click)="prevMonth()" aria-label="Previous month">◀</button>
    <h2 class="title">
      <button class="link" (click)="toggleMonthPicker()" [attr.aria-expanded]="monthPickerOpen">{{ monthName }}</button>
      <span> </span>
      <button class="link" (click)="toggleYearPicker()" [attr.aria-expanded]="yearPickerOpen">{{ viewYear }}</button>
    </h2>
    <div class="actions">
      <button class="nav" (click)="goToToday()" [disabled]="isOnCurrentMonth" title="Go to today">Today</button>
      <button class="nav" (click)="nextMonth()" aria-label="Next month">▶</button>
    </div>
  </header>

  <div class="pickers">
    <div class="picker" *ngIf="monthPickerOpen">
      <label>Month</label>
      <select [(ngModel)]="viewMonth" (ngModelChange)="onMonthSelectIndex($event)">
        @for (m of monthOptions; track m; let i = $index) {
          <option [value]="i">{{ m }}</option>
        }
      </select>
    </div>

    <div class="picker" *ngIf="yearPickerOpen">
      <label>Year</label>
      <div class="year-row">
        <input type="number" [(ngModel)]="yearInputValue" (keyup.enter)="applyYear()">
        <button class="nav" (click)="applyYear()">Apply</button>
      </div>
    </div>
  </div>

  <div class="cal-grid">
    <div class="dow">M</div>
    <div class="dow">T</div>
    <div class="dow">W</div>
    <div class="dow">T</div>
    <div class="dow">F</div>
    <div class="dow">S</div>
    <div class="dow">S</div>

    @for (week of weeks; track week) {
      @for (day of week; track day) {
        <div class="cell empty" *ngIf="!day"></div>
        <details class="cell" *ngIf="day" [class.today]="isToday(day)">
          <summary><span class="num">{{ day!.getDate() }}</span></summary>
          <nav class="menu">
            <a [routerLink]="['/app/history']" [queryParams]="{ date: iso(day!) }">History</a>
          </nav>
        </details>
      }
    }
  </div>
</section>
