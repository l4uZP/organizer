<div class="diary-page">
  <div class="header">
    <h2>Today's notes</h2>
    <div class="date">{{ todayStr }}</div>
  </div>

  <div class="layout">
    <div class="composer">
      <form [formGroup]="form" (ngSubmit)="addNote()">
        <textarea formControlName="content" rows="6" placeholder="Write your note..."></textarea>
        <div class="actions">
          <button type="submit" [disabled]="form.invalid">Add note</button>
        </div>
      </form>
    </div>

    <div class="list">
      <div class="list-title">Notes for today</div>
      <ng-container *ngIf="notes.length; else emptyState">
        <button class="note-item" *ngFor="let n of notes" (click)="select(n)">
          {{ n.content.length > 100 ? (n.content | slice:0:100) + '...' : n.content }}
        </button>
      </ng-container>
      <ng-template #emptyState>
        <div class="empty">There are no notes yet for today.</div>
      </ng-template>
    </div>

    <!-- Modal -->
    <div class="modal-backdrop" *ngIf="modalOpen" (click)="closeModal()"></div>
    <div class="modal" *ngIf="modalOpen && selected as s">
      <div class="modal-header">
        <div class="title">Note from {{ s.note_date }}</div>
        <button class="close" (click)="closeModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div *ngIf="!editing" class="content-view">
          <pre>{{ s.content }}</pre>
        </div>
        <div *ngIf="editing" class="content-edit">
          <textarea rows="10" [(ngModel)]="editingContent"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <div class="spacer"></div>
        <button class="danger" (click)="deleteSelected()">Delete</button>
        <button *ngIf="!editing" (click)="startEdit()">Edit</button>
        <button *ngIf="editing" (click)="saveEdit()">Save</button>
        <button *ngIf="editing" type="button" (click)="editing=false">Cancel</button>
      </div>
    </div>
  </div>
</div>


