<div class="pomodoro">
  <div class="dots">
    <span class="dot" *ngFor="let d of dotsArray; let idx = index" [class]="d"></span>
  </div>

  <div class="timer" [class.break-phase]="phase !== 'focus'">
    <svg viewBox="0 0 120 120" class="circle">
      <circle cx="60" cy="60" r="54" class="bg" />
      <circle cx="60" cy="60" r="54" class="progress"
              [style.stroke-dasharray]="339.292"
              [style.stroke-dashoffset]="(339.292 * (1 - percentage / 100))"/>
    </svg>
    <div class="center">
      <div class="phase" [class.focus]="phase === 'focus'" [class.break]="phase !== 'focus'">
        {{ phase === 'focus' ? 'Focus' : (phase === 'short' ? 'Pausa corta' : 'Pausa larga') }}
      </div>
      <div class="time">{{ displayTime }}</div>
    </div>
  </div>

  <div class="controls">
    <button class="btn btn-primary" (click)="toggleRun.emit()">
      {{ isRunning ? 'Pausa' : 'Iniciar' }}
    </button>
    <button class="btn" (click)="skip.emit()">Saltar</button>
    <button class="btn" (click)="onToggleSettings()">Configurar</button>
    <label class="auto-continue">
      <input type="checkbox" [(ngModel)]="autoContinueLocal">
      Ejecución continua
    </label>
  </div>

  <div class="settings" *ngIf="showSettings">
    <div class="row">
      <label>Focus (min)</label>
      <input type="number" [(ngModel)]="focusMinutesLocal" min="1">
    </div>
    <div class="row">
      <label>Pausa corta (min)</label>
      <input type="number" [(ngModel)]="shortBreakMinutesLocal" min="1">
    </div>
    <div class="row">
      <label>Pausa larga (min)</label>
      <input type="number" [(ngModel)]="longBreakMinutesLocal" min="1">
    </div>
    <div class="row">
      <label>Intervalo de pausas largas (focus)</label>
      <input type="number" [(ngModel)]="longBreakIntervalLocal" min="1" max="20">
    </div>
    <div class="row">
      <label>Iteraciones</label>
      <input type="number" [(ngModel)]="iterationsPerCycleLocal" min="1" max="10">
    </div>
    <div class="row">
      <button class="btn btn-primary" (click)="onApplySettings()">Aplicar</button>
    </div>
  </div>

  <div class="completion" *ngIf="showCompletion">
    <div class="card">
      <h3>¡Iteraciones completadas!</h3>
      <p>¿Deseas continuar con más iteraciones o terminar la sesión?</p>
      <div class="row">
        <label>Iteraciones adicionales</label>
        <input type="number" [(ngModel)]="extraIterationsLocal" min="1" max="20">
      </div>
      <div class="actions">
        <button class="btn btn-primary" (click)="continueAfterCompletion.emit()">Continuar</button>
        <button class="btn" (click)="endSession.emit()">Terminar sesión</button>
      </div>
    </div>
  </div>
</div>
